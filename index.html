<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plataforma EAD - Educadq</title>
    <style>
        :root { --primary: #0f3460; --accent: #e94560; --success: #27ae60; --bg: #f4f7f6; --white: #fff; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: var(--bg); color: #333; }
        .hidden { display: none !important; }
        
        /* Layout */
        .wrapper { display: flex; min-height: 100vh; }
        .sidebar { width: 260px; background: var(--primary); color: white; padding: 20px; flex-shrink: 0; }
        .main { flex: 1; padding: 30px; }
        .nav-item { padding: 12px; cursor: pointer; border-radius: 6px; margin-bottom: 5px; transition: 0.3s; }
        .nav-item:hover, .active { background: var(--accent); }

        /* Cards e Listas */
        .card { background: var(--white); padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .item-aula { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #eee; background: white; margin-bottom: 5px; border-radius: 8px; }

        /* Prova e Bot√µes */
        .btn { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; color: white; transition: 0.3s; }
        .btn-primary { background: var(--primary); }
        .btn-success { background: var(--success); }
        .btn-accent { background: var(--accent); }
        .btn-disabled { background: #ccc; cursor: not-allowed; }

        /* Certificado Estilo Profissional */
        #printable-certificate {
            width: 800px; height: 550px; padding: 40px; border: 15px double var(--primary);
            background: white; text-align: center; position: relative; margin: 0 auto;
        }
        .cert-header { color: var(--primary); border-bottom: 2px solid var(--accent); padding-bottom: 10px; margin-bottom: 20px; }
        
        /* Forms */
        input, select { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ddd; border-radius: 6px; }

        @media print {
            body * { visibility: hidden; }
            #printable-certificate, #printable-certificate * { visibility: visible; }
            #printable-certificate { position: absolute; left: 0; top: 0; }
        }
    </style>
</head>
<body>

    <section id="login-screen" style="display:flex; justify-content:center; align-items:center; height:100vh; background:var(--primary)">
        <div class="card" style="width:350px; text-align:center">
            <h2 style="color:var(--primary)">EDUCADQ EAD</h2>
            <input type="text" id="user-login" placeholder="Usu√°rio">
            <input type="password" id="pass-login" placeholder="Senha">
            <button class="btn btn-accent" style="width:100%" onclick="tentarLogin()">ENTRAR</button>
            <p style="font-size: 11px; margin-top: 10px; color: #666;">Admin: admin / 123</p>
        </div>
    </section>

    <section id="dash-screen" class="hidden">
        <div class="wrapper">
            <nav class="sidebar">
                <h3 id="display-user-name">Bem-vindo</h3>
                <div class="nav-item active" onclick="showTab('tab-cursos')">üìö Meus Cursos</div>
                <div id="admin-tools" class="hidden">
                    <hr>
                    <div class="nav-item" onclick="showTab('tab-adm-cursos')">‚öôÔ∏è Gerenciar Cursos</div>
                    <div class="nav-item" onclick="showTab('tab-adm-alunos')">üë• Cadastrar Alunos</div>
                    <div class="nav-item" onclick="showTab('tab-adm-provas')">üìù Criar Provas</div>
                </div>
                <div class="nav-item" style="margin-top:20px" onclick="location.reload()">üö™ Sair</div>
            </nav>

            <main class="main">
                <div id="tab-cursos" class="tab-content">
                    <h1>Meus Treinamentos</h1>
                    <div id="grid-cursos-aluno" class="grid"></div>
                </div>

                <div id="tab-grade" class="tab-content hidden">
                    <button class="btn btn-primary" onclick="showTab('tab-cursos')">‚¨Ö Voltar</button>
                    <h1 id="grade-titulo-curso">Curso</h1>
                    <div id="grade-lista-aulas"></div>
                    <hr>
                    <div id="area-prova-liberacao" class="card" style="text-align: center;">
                        <h3>Avalia√ß√£o Final</h3>
                        <p id="prova-status-msg">Assista todas as aulas para liberar a prova.</p>
                        <button id="btn-iniciar-prova" class="btn btn-disabled" disabled>Fazer Prova</button>
                    </div>
                </div>

                <div id="tab-fazer-prova" class="tab-content hidden">
                    <h1 id="prova-curso-nome">Prova</h1>
                    <div id="questoes-container" class="card"></div>
                    <button class="btn btn-success" onclick="corrigirProva()">Enviar Respostas</button>
                </div>

                <div id="tab-view-cert" class="tab-content hidden">
                    <button class="btn btn-primary" onclick="showTab('tab-cursos')">‚¨Ö Voltar</button>
                    <button class="btn btn-success" onclick="window.print()">üñ®Ô∏è Imprimir Certificado</button>
                    <br><br>
                    <div id="printable-certificate">
                        <div class="cert-header">
                            <h2>Centro de Forma√ß√£o e Estudos sobre √Ålcool e Drogas Educadq</h2>
                            <p>CNPJ: 50.062.731/0001-30 | Pontal do Paran√°, PR</p>
                        </div>
                        <p>Certificamos para os devidos fins que</p>
                        <h1 id="cert-aluno-nome" style="font-size: 40px; color: var(--accent);">NOME DO ALUNO</h1>
                        <p>concluiu com aproveitamento superior a 70% o curso de</p>
                        <h2 id="cert-curso-nome" style="color: var(--primary);">NOME DO CURSO</h2>
                        <p>Realizado atrav√©s da plataforma de ensino √† dist√¢ncia.</p>
                        <div style="margin-top: 50px; border-top: 1px solid #333; display: inline-block; width: 300px;">
                            <p>Dire√ß√£o Educadq</p>
                        </div>
                    </div>
                </div>

                <div id="tab-adm-alunos" class="tab-content hidden">
                    <h1>Gerenciar Alunos</h1>
                    <div class="card" style="max-width: 400px;">
                        <input type="text" id="adm-aluno-nome" placeholder="Nome Completo">
                        <input type="text" id="adm-aluno-user" placeholder="Usu√°rio (Login)">
                        <input type="password" id="adm-aluno-pass" placeholder="Senha">
                        <button class="btn btn-success" onclick="admSalvarAluno()">Salvar Aluno</button>
                    </div>
                    <div id="lista-alunos-cadastrados"></div>
                </div>

                <div id="tab-adm-provas" class="tab-content hidden">
                    <h1>Cadastrar Quest√£o</h1>
                    <div class="card" style="max-width: 500px;">
                        <select id="adm-prova-curso-select"></select>
                        <input type="text" id="adm-pergunta" placeholder="A Pergunta">
                        <input type="text" id="opt0" placeholder="Op√ß√£o A">
                        <input type="text" id="opt1" placeholder="Op√ß√£o B">
                        <input type="text" id="opt2" placeholder="Op√ß√£o C">
                        <select id="adm-correct">
                            <option value="0">Correta: A</option>
                            <option value="1">Correta: B</option>
                            <option value="2">Correta: C</option>
                        </select>
                        <button class="btn btn-success" onclick="admSalvarQuestao()">Adicionar Quest√£o</button>
                    </div>
                </div>

                <div id="tab-adm-cursos" class="tab-content hidden">
                    <h1>Cursos e Aulas</h1>
                    <div class="card">
                         <input type="text" id="adm-c-nome" placeholder="Nome do Curso">
                         <input type="text" id="adm-c-capa" placeholder="Link Imagem Capa">
                         <button class="btn btn-primary" onclick="admCriarCurso()">Criar Curso</button>
                    </div>
                    <div class="card">
                        <select id="adm-aula-c-select"></select>
                        <input type="text" id="adm-a-nome" placeholder="T√≠tulo da Aula">
                        <input type="text" id="adm-a-url" placeholder="Link YouTube">
                        <button class="btn btn-success" onclick="admSalvarAula()">Vincular Aula</button>
                    </div>
                </div>

                <div id="tab-player" class="tab-content hidden">
                    <button class="btn btn-primary" onclick="showTab('tab-grade')">‚¨Ö Voltar para Grade</button>
                    <h2 id="player-titulo">Aula</h2>
                    <div class="card" style="padding:0; overflow:hidden">
                        <div style="position:relative; padding-bottom:56.25%; height:0">
                            <iframe id="video-frame" style="position:absolute; top:0; left:0; width:100%; height:100%" frameborder="0" allowfullscreen referrerpolicy="strict-origin-when-cross-origin"></iframe>
                        </div>
                    </div>
                    <button id="btn-concluir-aula" class="btn btn-success" style="width:100%; margin-top:10px">Marcar Aula como Conclu√≠da ‚úÖ</button>
                </div>
            </main>
        </div>
    </section>

    <script>
        // --- BANCO DE DADOS INICIAL ---
        let db = JSON.parse(localStorage.getItem('ead_educadq_v1')) || {
            cursos: [],
            alunos: [{nome: "Administrador", user: "admin", pass: "123", progresso: {}, notas: {}}]
        };

        let currentUser = null;
        let cursoAtivoIdx = null;

        function salvarDB() { localStorage.setItem('ead_educadq_v1', JSON.stringify(db)); }

        // --- LOGIN ---
        function tentarLogin() {
            const u = document.getElementById('user-login').value;
            const p = document.getElementById('pass-login').value;
            const aluno = db.alunos.find(a => a.user === u && a.pass === p);

            if(aluno) {
                currentUser = aluno;
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('dash-screen').classList.remove('hidden');
                document.getElementById('display-user-name').innerText = "Ol√°, " + aluno.nome;
                if(u === 'admin') document.getElementById('admin-tools').classList.remove('hidden');
                renderHome();
                renderSelects();
            } else { alert("Usu√°rio ou senha inv√°lidos!"); }
        }

        // --- NAVEGA√á√ÉO ALUNO ---
        function renderHome() {
            const grid = document.getElementById('grid-cursos-aluno');
            grid.innerHTML = "";
            db.cursos.forEach((c, idx) => {
                grid.innerHTML += `
                    <div class="card" style="cursor:pointer" onclick="abrirGrade(${idx})">
                        <img src="${c.capa}" style="width:100%; height:150px; border-radius:8px; object-fit:cover">
                        <h3>${c.nome}</h3>
                        <p>${c.aulas.length} Aulas | Status: ${db.alunos.find(a => a.user === currentUser.user).notas[idx] >= 70 ? '‚úÖ Aprovado' : '‚è≥ Em curso'}</p>
                    </div>`;
            });
        }

        function abrirGrade(idx) {
            cursoAtivoIdx = idx;
            const curso = db.cursos[idx];
            document.getElementById('grade-titulo-curso').innerText = curso.nome;
            const lista = document.getElementById('grade-lista-aulas');
            lista.innerHTML = "";

            let concluidas = currentUser.progresso[idx] || [];
            
            curso.aulas.forEach((aula, aIdx) => {
                const isCheck = concluidas.includes(aIdx) ? "‚úÖ" : "‚≠ï";
                lista.innerHTML += `
                    <div class="item-aula">
                        <span>${isCheck} Aula ${aIdx+1}: ${aula.nome}</span>
                        <button class="btn btn-primary" onclick="assistir(${idx}, ${aIdx})">Assistir</button>
                    </div>`;
            });

            // L√≥gica de Trava da Prova
            const btnProva = document.getElementById('btn-iniciar-prova');
            if(concluidas.length === curso.aulas.length && curso.aulas.length > 0) {
                btnProva.disabled = false;
                btnProva.className = "btn btn-accent";
                btnProva.onclick = () => iniciarProva(idx);
                document.getElementById('prova-status-msg').innerText = "Todas as aulas conclu√≠das! Voc√™ pode fazer a prova.";
            } else {
                btnProva.disabled = true;
                btnProva.className = "btn btn-disabled";
                document.getElementById('prova-status-msg').innerText = "Assista todas as aulas para liberar a prova.";
            }

            // Bot√£o Certificado
            if(currentUser.notas[idx] >= 70) {
                document.getElementById('area-prova-liberacao').innerHTML += `<button class="btn btn-success" onclick="gerarCertificado(${idx})">VER CERTIFICADO</button>`;
            }

            showTab('tab-grade');
        }

        function assistir(cIdx, aIdx) {
            const aula = db.cursos[cIdx].aulas[aIdx];
            document.getElementById('player-titulo').innerText = aula.nome;
            document.getElementById('video-frame').src = aula.url;
            document.getElementById('btn-concluir-aula').onclick = () => {
                if(!currentUser.progresso[cIdx]) currentUser.progresso[cIdx] = [];
                if(!currentUser.progresso[cIdx].includes(aIdx)) currentUser.progresso[cIdx].push(aIdx);
                salvarDB();
                alert("Aula conclu√≠da!");
                abrirGrade(cIdx);
            };
            showTab('tab-player');
        }

        // --- SISTEMA DE PROVA ---
        function iniciarProva(idx) {
            const curso = db.cursos[idx];
            if(!curso.questoes || curso.questoes.length === 0) return alert("Admin ainda n√£o cadastrou perguntas para este curso.");
            
            document.getElementById('prova-curso-nome').innerText = "Avalia√ß√£o: " + curso.nome;
            const container = document.getElementById('questoes-container');
            container.innerHTML = "";

            curso.questoes.forEach((q, qIdx) => {
                container.innerHTML += `
                    <div style="margin-bottom:20px; border-bottom:1px solid #eee; padding-bottom:10px">
                        <p><strong>${qIdx+1}. ${q.pergunta}</strong></p>
                        ${q.opts.map((opt, oIdx) => `
                            <label style="display:block"><input type="radio" name="q${qIdx}" value="${oIdx}"> ${opt}</label>
                        `).join('')}
                    </div>`;
            });
            showTab('tab-fazer-prova');
        }

        function corrigirProva() {
            const curso = db.cursos[cursoAtivoIdx];
            let acertos = 0;
            curso.questoes.forEach((q, qIdx) => {
                const marcada = document.querySelector(`input[name="q${qIdx}"]:checked`);
                if(marcada && marcada.value == q.correct) acertos++;
            });

            const nota = (acertos / curso.questoes.length) * 100;
            currentUser.notas[cursoAtivoIdx] = nota;
            salvarDB();

            if(nota >= 70) {
                alert(`Parab√©ns! Sua nota foi ${nota.toFixed(0)}%. Certificado liberado!`);
                gerarCertificado(cursoAtivoIdx);
            } else {
                alert(`Nota ${nota.toFixed(0)}%. Voc√™ precisa de 70% para passar. Estude mais e tente novamente.`);
                abrirGrade(cursoAtivoIdx);
            }
        }

        function gerarCertificado(idx) {
            document.getElementById('cert-aluno-nome').innerText = currentUser.nome.toUpperCase();
            document.getElementById('cert-curso-nome').innerText = db.cursos[idx].nome.toUpperCase();
            showTab('tab-view-cert');
        }

        // --- FUN√á√ïES ADMIN ---
        function admCriarCurso() {
            const nome = document.getElementById('adm-c-nome').value;
            const capa = document.getElementById('adm-c-capa').value || "https://images.unsplash.com/photo-1501504905252-473c47e087f8?w=500";
            db.cursos.push({nome, capa, aulas: [], questoes: []});
            salvarDB(); renderSelects(); alert("Curso criado!");
        }

        function admSalvarAula() {
            const cIdx = document.getElementById('adm-aula-c-select').value;
            const nome = document.getElementById('adm-a-nome').value;
            let url = document.getElementById('adm-a-url').value;
            
            // Corrige link do YouTube
            let id = url.includes("v=") ? url.split("v=")[1].split("&")[0] : url.split("/").pop();
            url = `https://www.youtube.com/embed/${id}?rel=0&origin=${window.location.origin}`;

            db.cursos[cIdx].aulas.push({nome, url});
            salvarDB(); alert("Aula vinculada!");
        }

        function admSalvarQuestao() {
            const cIdx = document.getElementById('adm-prova-curso-select').value;
            const q = {
                pergunta: document.getElementById('adm-pergunta').value,
                opts: [document.getElementById('opt0').value, document.getElementById('opt1').value, document.getElementById('opt2').value],
                correct: document.getElementById('adm-correct').value
            };
            db.cursos[cIdx].questoes.push(q);
            salvarDB(); alert("Quest√£o adicionada!");
        }

        function admSalvarAluno() {
            const nome = document.getElementById('adm-aluno-nome').value;
            const user = document.getElementById('adm-aluno-user').value;
            const pass = document.getElementById('adm-aluno-pass').value;
            db.alunos.push({nome, user, pass, progresso: {}, notas: {}});
            salvarDB(); alert("Aluno cadastrado!");
        }

        function renderSelects() {
            const s1 = document.getElementById('adm-aula-c-select');
            const s2 = document.getElementById('adm-prova-curso-select');
            s1.innerHTML = s2.innerHTML = "";
            db.cursos.forEach((c, i) => {
                const opt = `<option value="${i}">${c.nome}</option>`;
                s1.innerHTML += opt; s2.innerHTML += opt;
            });
        }

        function showTab(id) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
            if(id === 'tab-cursos') renderHome();
        }
    </script>
</body>
</html>
